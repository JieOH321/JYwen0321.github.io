<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 苹果设备视口优化 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>蓝色浪漫 · 时光记忆</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Three.js库 -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    <!-- 引入圆润字体增强温馨感 -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C6E5FF',    // 浅天蓝
                        secondary: '#7CB9E8',   // 淡蓝
                        accent: '#2E86AB',     // 深海蓝
                        light: '#F0F8FF',      // 淡蓝白
                        love: '#FF9EBB',       // 淡粉
                        overlay: 'rgba(240, 248, 255, 0.92)'
                    },
                    fontFamily: {
                        sans: ['"Nunito"', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'romantic': '0 8px 24px -4px rgba(124, 185, 232, 0.2)',
                        'romantic-lg': '0 16px 36px -6px rgba(46, 134, 171, 0.15)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow-soft {
                text-shadow: 0 2px 4px rgba(46, 134, 171, 0.1);
            }
            .bg-blur {
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px); /* 苹果设备兼容 */
            }
            /* 苹果设备触摸优化 */
            .touch-friendly {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .ios-button {
                -webkit-appearance: none;
                appearance: none;
            }
            /* 安全区域适配 */
            .safe-area-inset-top {
                padding-top: env(safe-area-inset-top);
            }
            .safe-area-inset-bottom {
                padding-bottom: env(safe-area-inset-bottom);
            }
            /* 3D照片墙容器 - 响应式高度 */
            #photo-sphere-container {
                width: 100%;
                height: 55vh; /* 手机默认高度 */
            }
            @media (min-width: 768px) { /* iPad尺寸 */
                #photo-sphere-container {
                    height: 65vh;
                }
            }
            /* 照片查看弹窗 */
            .photo-modal {
                opacity: 0;
                visibility: hidden;
                transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                transform: scale(0.9);
            }
            .photo-modal.active {
                opacity: 1;
                visibility: visible;
                transform: scale(1);
            }
        }

        /* 动画定义 */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse-love {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.15); opacity: 1; }
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light via-primary to-secondary/20 min-h-screen font-sans text-accent overflow-x-hidden touch-friendly safe-area-inset-top safe-area-inset-bottom">
    <!-- 全局浪漫装饰：漂浮小爱心 -->
    <div id="floating-hearts" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- 全局浪漫装饰：星光点缀 -->
    <div id="stars" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- 1. 密码页面 -->
    <section id="password-section" class="min-h-screen flex items-center justify-center p-4 relative trans-1">
        <div class="absolute inset-0 overflow-hidden z-0">
            <div class="absolute top-[15%] left-[10%] w-48 h-48 bg-secondary/10 rounded-full blur-2xl float-slow"></div>
            <div class="absolute bottom-[25%] right-[15%] w-64 h-64 bg-love/5 rounded-full blur-2xl float-medium"></div>
        </div>
        
        <div class="bg-white/90 bg-blur rounded-3xl shadow-romantic-lg p-6 sm:p-8 md:p-12 w-full max-w-md transform hover:scale-[1.02] transition-all duration-500 relative z-10">
            <div class="text-center mb-8">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-12 h-0.5 bg-secondary/40 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love text-xl"></i>
                    <span class="w-12 h-0.5 bg-secondary/40 rounded-full"></span>
                </div>
                <h1 class="text-[clamp(1.6rem,5vw,2.6rem)] font-bold text-accent mb-3 text-shadow-soft">我们的秘密花园</h1>
                <p class="text-gray-600/70 text-sm sm:text-base">输入密码，开启专属浪漫回忆</p>
            </div>
            
            <div class="mb-7">
                <label for="password" class="block text-sm font-medium text-gray-600/80 mb-2">爱的密码</label>
                <div class="relative">
                    <input type="password" id="password" class="w-full px-4 py-3.5 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 text-lg bg-light/60 placeholder-gray-400/70 ios-button" placeholder="例如：我们的纪念日">
                    <button id="toggle-password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500/70 hover:text-accent transition-all duration-300 touch-friendly">
                        <i class="fa fa-eye-slash text-lg"></i>
                    </button>
                </div>
            </div>
            
            <button id="submit-password" class="w-full bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-6 rounded-xl shadow-romantic hover:shadow-lg transition-all duration-300 flex items-center justify-center group mb-5 ios-button touch-friendly">
                <span>进入回忆</span>
                <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
            
            <div class="text-center">
                <button id="hint-btn" class="text-secondary hover:text-accent text-sm font-medium transition-all duration-300 flex items-center justify-center group touch-friendly">
                    <i class="fa fa-lightbulb-o mr-1 text-love group-hover:scale-110 transition-transform"></i>
                    <span>需要密码提示吗？</span>
                </button>
            </div>
        </div>
    </section>

    <!-- 密码提示弹窗 -->
    <div id="hint-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="modal-content">
            <div class="text-center mb-6">
                <i class="fa fa-heart text-love text-3xl mb-3 pulse-love"></i>
                <h3 class="text-xl font-bold text-accent mb-2">密码提示</h3>
                <p class="text-gray-600/80">我们第一次确定关系的那一天（格式：YYYYMMDD）</p>
            </div>
            <button id="close-hint" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                我知道了
            </button>
        </div>
    </div>

    <!-- 2. 倒计时页面 -->
    <section id="countdown-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-1 hidden opacity-0 translate-y-10">
        <!-- 头像+爱心装饰 -->
        <div class="flex items-center justify-center mb-10 w-full max-w-lg px-4">
            <!-- 左侧头像 -->
            <div class="relative group">
                <div class="w-20 h-20 sm:w-24 sm:h-24 md:w-32 md:h-32 rounded-full overflow-hidden border-4 border-white/90 shadow-romantic">
                    <img src="https://picsum.photos/seed/avatar1/300/300" alt="你的头像" class="w-full h-full object-cover">
                </div>
                <label for="avatar1-upload" class="absolute -bottom-2 -right-2 bg-secondary/90 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-all duration-300 shadow-md touch-friendly">
                    <i class="fa fa-camera"></i>
                </label>
                <input type="file" id="avatar1-upload" accept="image/*" class="hidden">
            </div>
            
            <!-- 中间爱心 -->
            <div class="mx-3 sm:mx-4 md:mx-8">
                <div class="text-3xl sm:text-4xl md:text-5xl text-transparent bg-clip-text bg-gradient-to-r from-love to-secondary pulse-love">
                    <i class="fa fa-heart"></i>
                </div>
            </div>
            
            <!-- 右侧头像 -->
            <div class="relative group">
                <div class="w-20 h-20 sm:w-24 sm:h-24 md:w-32 md:h-32 rounded-full overflow-hidden border-4 border-white/90 shadow-romantic">
                    <img src="https://picsum.photos/seed/avatar2/300/300" alt="对方的头像" class="w-full h-full object-cover">
                </div>
                <label for="avatar2-upload" class="absolute -bottom-2 -right-2 bg-secondary/90 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-all duration-300 shadow-md touch-friendly">
                    <i class="fa fa-camera"></i>
                </label>
                <input type="file" id="avatar2-upload" accept="image/*" class="hidden">
            </div>
        </div>
        
        <!-- 倒计时卡片 -->
        <div class="text-center mb-12 px-4">
            <h2 class="text-[clamp(1.5rem,6vw,3rem)] font-bold text-accent mb-6 text-shadow-soft">我们已经在一起</h2>
            <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 md:p-10 inline-block w-full max-w-md">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6">
                    <div class="text-center">
                        <div id="days" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">天</div>
                    </div>
                    <div class="text-center">
                        <div id="hours" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">时</div>
                    </div>
                    <div class="text-center">
                        <div id="minutes" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">分</div>
                    </div>
                    <div class="text-center">
                        <div id="seconds" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">秒</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 纪念日提醒 -->
        <div class="bg-white/90 bg-blur rounded-xl shadow-romantic p-5 sm:p-6 mb-10 max-w-md w-full text-center">
            <h3 class="font-bold text-lg mb-2 text-accent flex items-center">
                <i class="fa fa-calendar text-secondary mr-2"></i>下一个纪念日
            </h3>
            <p id="next-anniversary" class="text-gray-600/80 text-sm sm:text-base"></p>
        </div>
        
        <!-- 进入照片墙按钮 -->
        <button id="to-photo-wall" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group ios-button touch-friendly">
            查看我们的照片球
            <i class="fa fa-picture-o ml-2 group-hover:rotate-12 transition-transform"></i>
        </button>
    </section>

    <!-- 3. 3D球形照片墙页面 -->
    <section id="photo-wall-section" class="min-h-screen p-4 sm:p-6 md:p-8 trans-2 hidden opacity-0 translate-y-10">
        <div class="max-w-7xl mx-auto">
            <!-- 页面标题 -->
            <div class="text-center mb-8 sm:mb-10">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love"></i>
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                </div>
                <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-3 text-shadow-soft">我们的回忆星球</h2>
                <p class="text-gray-600/70 max-w-2xl mx-auto text-sm sm:text-base">
                    82张照片组成的浪漫星球，点击可放大查看，双指缩放或拖动旋转
                </p>
            </div>
            
            <!-- 照片墙控制栏 -->
            <div class="flex flex-wrap justify-center gap-3 sm:gap-4 mb-6">
                <button id="reset-sphere" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-refresh mr-1"></i> 重置视角
                </button>
                <button id="restart-animation" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-repeat mr-1"></i> 重新汇聚
                </button>
                <button id="toggle-rotation" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-pause mr-1"></i> 暂停旋转
                </button>
                <label for="photo-upload" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm cursor-pointer ios-button touch-friendly">
                    <i class="fa fa-upload mr-1"></i> 上传照片
                </label>
                <input type="file" id="photo-upload" accept="image/*" multiple class="hidden">
            </div>
            
            <!-- 3D球形照片墙容器 -->
            <div id="photo-sphere-container" class="mb-8 touch-friendly" touch-action="none">
                <!-- Three.js渲染内容将插入这里 -->
                <div class="absolute inset-0 flex items-center justify-center z-10" id="loading-overlay">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-secondary/30 border-t-secondary rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-accent/80">照片星球加载中...</p>
                    </div>
                </div>
            </div>
            
            <!-- 操作提示 -->
            <div class="bg-white/80 bg-blur rounded-xl shadow-romantic p-4 sm:p-5 max-w-2xl mx-auto text-center">
                <p class="text-gray-600/80 text-sm sm:text-base flex items-center justify-center gap-2 flex-wrap">
                    <i class="fa fa-hand-pointer-o text-secondary"></i> 拖拽旋转星球 
                    <span class="inline-block w-1 h-1 bg-secondary/40 rounded-full hidden sm:inline-block"></span> 
                    <i class="fa fa-arrows-alt text-secondary"></i> 双指缩放 
                    <span class="inline-block w-1 h-1 bg-secondary/40 rounded-full hidden sm:inline-block"></span> 
                    <i class="fa fa-image text-secondary"></i> 点击查看照片
                </p>
            </div>
            
            <!-- 进入互动环节按钮 -->
            <div class="text-center mt-10">
                <button id="to-interaction" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group mx-auto ios-button touch-friendly">
                    继续互动之旅
                    <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- 照片查看弹窗 -->
    <div class="photo-modal fixed inset-0 bg-overlay bg-blur flex items-center justify-center p-4 z-50" id="photo-view-modal">
        <div class="relative max-w-2xl w-full max-h-[90vh]">
            <button id="close-photo-modal" class="absolute -top-12 right-0 text-accent/80 hover:text-accent transition-all duration-300 text-2xl touch-friendly">
                <i class="fa fa-times"></i>
            </button>
            <div class="bg-white rounded-xl shadow-romantic-lg overflow-hidden">
                <div class="p-1 bg-light">
                    <img id="view-photo" src="" alt="查看照片" class="w-full h-auto max-h-[70vh] object-contain">
                </div>
                <div class="p-4 sm:p-5 text-center">
                    <h4 id="photo-caption" class="font-medium text-accent">照片回忆</h4>
                    <p id="photo-date" class="text-gray-500/70 text-sm mt-1">拍摄日期</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. 互动问答页面 -->
    <section id="interaction-section" class="min-h-screen p-4 sm:p-6 md:p-8 trans-3 hidden opacity-0 rotate-1">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-8 sm:mb-12">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love"></i>
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                </div>
                <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-3 text-shadow-soft">爱的互动空间</h2>
                <p class="text-gray-600/70 text-sm sm:text-base">在这里留下你想对我说的话</p>
            </div>
            
            <!-- 响应式网格布局 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 mb-10">
                <!-- 爱的问答环节 -->
                <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic p-5 sm:p-6 md:p-8 transform hover:-translate-y-1 transition-all duration-300">
                    <h3 class="font-bold text-lg sm:text-xl mb-5 text-accent flex items-center">
                        <i class="fa fa-question-circle text-secondary mr-2"></i>
                        爱的问答
                    </h3>
                    
                    <div id="quiz-container" class="mb-5">
                        <div class="question-text text-base sm:text-lg font-medium mb-4 text-accent/90">我最喜欢的花是什么？</div>
                        <div class="mb-4">
                            <input type="text" id="answer-input" class="w-full px-4 py-3 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 bg-light/50 ios-button" placeholder="请输入答案...">
                        </div>
                        <div class="flex flex-wrap justify-between items-center gap-2 mb-4">
                            <button id="hint-question" class="text-secondary hover:text-accent text-sm font-medium transition-all duration-300 flex items-center touch-friendly">
                                <i class="fa fa-lightbulb-o mr-1 text-love"></i>
                                <span>提示</span>
                            </button>
                            <button id="cant-guess" class="text-gray-500/80 hover:text-gray-700 text-sm font-medium transition-all duration-300 flex items-center touch-friendly">
                                <span>我还猜不出来</span>
                            </button>
                        </div>
                        <div id="answer-feedback" class="hidden p-3 rounded-lg mb-4"></div>
                    </div>
                    
                    <button id="submit-answer" class="w-full bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3 px-6 rounded-xl shadow-sm hover:shadow transition-all duration-300 ios-button touch-friendly">
                        提交答案
                    </button>
                </div>
                
                <!-- 留言板 -->
                <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic p-5 sm:p-6 md:p-8 transform hover:-translate-y-1 transition-all duration-300">
                    <h3 class="font-bold text-lg sm:text-xl mb-5 text-accent flex items-center">
                        <i class="fa fa-pencil-square-o text-secondary mr-2"></i>
                        互动留言板
                    </h3>
                    
                    <div class="mb-5">
                        <textarea id="message-input" rows="4" class="w-full px-4 py-3 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 bg-light/50 resize-none ios-button" placeholder="写下你想对我说的话..."></textarea>
                        <div class="flex mt-2 justify-end gap-2">
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="❤️">❤️</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="😍">😍</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="💕">💕</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="💌">💌</button>
                        </div>
                    </div>
                    
                    <button id="send-message" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3 px-6 rounded-xl shadow-sm hover:shadow transition-all duration-300 flex items-center justify-center group ios-button touch-friendly">
                        <i class="fa fa-paper-plane mr-2 group-hover:translate-x-1 transition-transform"></i> 发送
                    </button>
                    
                    <div id="messages-container" class="mt-6 sm:mt-8 space-y-3 max-h-64 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-secondary/30">
                        <div class="bg-light p-4 rounded-xl text-gray-700 animate-fadeIn">
                            <p>这是我们的第一条留言，开始我们的互动吧！</p>
                            <div class="text-right text-xs text-gray-500/70 mt-1">刚刚</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button id="to-video" class="bg-gradient-to-r from-love/80 to-love text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 pulse-love ios-button touch-friendly" disabled>
                    最后的惊喜
                    <i class="fa fa-film ml-2"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- 5. 视频页面 -->
    <section id="video-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-4 hidden opacity-0 scale-95">
        <div class="text-center mb-8 sm:mb-12 px-4 max-w-3xl">
            <div class="flex justify-center items-center gap-3 mb-4">
                <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                <i class="fa fa-heart text-love pulse-love"></i>
                <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
            </div>
            <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-4 text-shadow-soft">给你的特别礼物</h2>
            <p class="text-gray-600/70 text-sm sm:text-base">这是我为你准备的视频，记录了我们在一起的美好时光，点击播放，让我们一起回忆这些珍贵的瞬间。</p>
        </div>
        
        <div class="relative w-full max-w-3xl bg-light rounded-2xl overflow-hidden shadow-romantic-lg">
            <video id="special-video" class="w-full aspect-video object-cover" poster="https://picsum.photos/seed/videoposter/1200/675" controls playsinline>
                <source src="your-video.mp4" type="video/mp4">
                你的浏览器不支持视频播放
            </audio>
            
            <div id="video-placeholder" class="absolute inset-0 flex items-center justify-center cursor-pointer bg-gradient-to-tr from-secondary/40 to-accent/40 touch-friendly">
                <div class="text-center p-6">
                    <i class="fa fa-play-circle text-white text-5xl sm:text-6xl mb-4 opacity-90 hover:opacity-100 transition-all duration-300 pulse-love"></i>
                    <p class="text-white text-base sm:text-xl font-medium text-shadow-soft">点击播放我们的回忆</p>
                </div>
            </div>
            
            <!-- 视频弹幕容器 -->
            <div id="video-danmaku" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
            <!-- 弹幕输入 -->
            <div class="absolute bottom-20 left-0 right-0 px-4 flex">
                <input type="text" id="danmaku-input" placeholder="发送弹幕..." class="flex-1 bg-black/30 text-white px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-white/50 placeholder-white/60 ios-button">
                <button id="send-danmaku" class="ml-2 bg-white/30 hover:bg-white/40 text-white px-4 py-2 rounded-full transition-all duration-300 ios-button touch-friendly">
                    发送
                </button>
            </div>
        </div>
        
        <div class="mt-10 sm:mt-14 text-center px-4 max-w-2xl">
            <p class="text-gray-700 italic text-sm sm:text-base mb-6">"我爱你，不仅因为你是谁，还因为和你在一起时我是谁。"</p>
            <p class="text-accent font-medium text-lg">永远爱你的人</p>
            
            <button id="to-final" class="mt-8 bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group mx-auto ios-button touch-friendly">
                最后一页
                <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </section>

    <!-- 6. 最终页面 -->
    <section id="final-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-5 hidden">
        <div class="max-w-4xl mx-auto text-center px-4">
            <div class="mb-10">
                <i class="fa fa-heart text-6xl sm:text-7xl text-love pulse-love"></i>
            </div>
            
            <h2 class="text-[clamp(1.8rem,6vw,3.2rem)] font-bold text-accent mb-6 text-shadow-soft">我爱你</h2>
            
            <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 md:p-10 mb-10">
                <p class="text-gray-700 text-base sm:text-lg leading-relaxed mb-6">
                    从遇见你的那一刻起，我的心就为你而跳动。每一个与你共度的瞬间，都成为了我生命中最珍贵的回忆。
                    这82张照片，记录了我们一路走来的点点滴滴，未来还有更多的故事等着我们一起书写。
                </p>
                <p class="text-gray-700 text-base sm:text-lg leading-relaxed">
                    谢谢你出现在我的生命里，让每一天都充满了色彩和意义。无论未来如何，我都会牵着你的手，一起走下去。
                </p>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="restart-all" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center justify-center group ios-button touch-friendly">
                    <i class="fa fa-refresh mr-2 group-hover:rotate-180 transition-transform"></i> 重新开始
                </button>
                <button id="download-photos" class="bg-white/90 hover:bg-white text-accent font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center justify-center group ios-button touch-friendly">
                    <i class="fa fa-download mr-2 group-hover:translate-y-1 transition-transform"></i> 保存照片
                </button>
            </div>
        </div>
    </section>

    <!-- 各种弹窗 -->
    <div id="question-hint-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="question-hint-content">
            <h3 class="text-xl font-bold text-center mb-4 text-accent">提示</h3>
            <p class="text-center text-gray-600/80 mb-6" id="hint-text">是一种粉色的花，象征爱情</p>
            <button id="close-question-hint" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                我知道了
            </button>
        </div>
    </div>

    <div id="fail-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="fail-content">
            <div class="text-center mb-4">
                <i class="fa fa-heart text-love text-3xl pulse-love"></i>
            </div>
            <h3 class="text-xl font-bold text-center mb-2 text-accent">正确答案</h3>
            <p class="text-center text-gray-600/80 mb-6" id="correct-answer-text">我最喜欢的是玫瑰花</p>
            <button id="close-fail" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                知道了
            </button>
        </div>
    </div>

    <script>
        // 全局变量
        let scene, camera, renderer, controls;
        let photoSpheres = [];
        let sphereGroup;
        let isRotating = true;
        let rotationSpeed = 0.003;
        const totalPhotos = 82; // 82张照片
        let currentPhotoIndex = -1;
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

        // 初始化3D球形照片墙 - 针对iOS优化性能
        function initPhotoSphere() {
            // 创建场景
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f8ff);
            
            // 添加环境光
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            
            // 添加方向光
            const directionalLight = new THREE.DirectionalLight(0x7cb9e8, 0.6);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // 创建相机
            camera = new THREE.PerspectiveCamera(75, document.getElementById('photo-sphere-container').clientWidth / document.getElementById('photo-sphere-container').clientHeight, 0.1, 1000);
            camera.position.z = 10;
            
            // 创建渲染器 - iOS性能优化
            renderer = new THREE.WebGLRenderer({ 
                antialias: isIOS ? false : true, // iOS关闭抗锯齿提升性能
                powerPreference: "high-performance"
            });
            renderer.setSize(document.getElementById('photo-sphere-container').clientWidth, document.getElementById('photo-sphere-container').clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('photo-sphere-container').appendChild(renderer.domElement);
            
            // 创建控制器 - 优化触摸体验
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.3;
            controls.zoomSpeed = 0.5;
            controls.enablePan = false; // 禁用平移，避免触摸冲突
            
            // 针对iOS触摸优化
            if (isIOS) {
                controls.touches.ONE = THREE.TOUCH.ROTATE;
                controls.touches.TWO = THREE.TOUCH.DOLLY_ROTATE;
                rotationSpeed = 0.002; // 降低旋转速度，更适合触摸设备
            }
            
            // 创建照片组
            sphereGroup = new THREE.Group();
            scene.add(sphereGroup);
            
            // 创建82张照片
            createPhotos();
            
            // 添加窗口大小监听
            window.addEventListener('resize', onWindowResize);
            
            // 添加点击事件监听
            window.addEventListener('click', onPhotoClick);
            
            // 开始动画
            animate();
            
            // 隐藏加载提示
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 500);
            }, 1500);
        }
        
        // 创建照片 - 优化iOS加载性能
        function createPhotos() {
            // 清除现有照片
            while (sphereGroup.children.length > 0) {
                const child = sphereGroup.children[0];
                sphereGroup.remove(child);
            }
            photoSpheres = [];
            
            const radius = 5; // 球半径
            
            // 生成均匀分布在球面上的点
            for (let i = 0; i < totalPhotos; i++) {
                // 使用黄金螺旋算法生成均匀分布的点
                const y = 1 - (i / (totalPhotos - 1)) * 2; // y从1到-1
                const radius = Math.sqrt(1 - y * y); // 半径在y处的圆
                
                const theta = Math.PI * 2 * i / 1.618033988749895; // 黄金角
                
                const x = Math.cos(theta) * radius;
                const z = Math.sin(theta) * radius;
                
                // 创建平面几何体作为照片载体 - 简化几何体提升iOS性能
                const geometry = new THREE.PlaneGeometry(0.8, 0.8);
                
                // 使用随机图片作为示例
                const textureLoader = new THREE.TextureLoader();
                // 图片尺寸优化，适合iOS设备
                const texture = textureLoader.load(`https://picsum.photos/seed/photo${i}/300/300`);
                
                // 创建材质 - 优化透明度动画性能
                const material = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0
                });
                
                // 创建网格
                const photo = new THREE.Mesh(geometry, material);
                
                // 保存照片信息
                photo.userData = {
                    index: i,
                    url: `https://picsum.photos/seed/photo${i}/600/600`,
                    caption: `我们的回忆 #${i+1}`,
                    date: `2025-${(Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0')}-${(Math.floor(Math.random() * 28) + 1).toString().padStart(2, '0')}`
                };
                
                // 设置初始位置（分散状态）
                const randomX = (Math.random() - 0.5) * 20;
                const randomY = (Math.random() - 0.5) * 20;
                const randomZ = (Math.random() - 0.5) * 20;
                photo.position.set(randomX, randomY, randomZ);
                
                // 添加到组
                sphereGroup.add(photo);
                photoSpheres.push(photo);
                
                // 添加汇聚动画 - iOS设备降低动画复杂度
                const delay = isIOS ? i * 50 : i * 30; // iOS延迟更长，减少同时动画数量
                setTimeout(() => {
                    // 目标位置（球面上的点）
                    const targetX = x * radius;
                    const targetY = y * radius;
                    const targetZ = z * radius;
                    
                    // 动画时间
                    const duration = isIOS ? 3000 + Math.random() * 1000 : 2000 + Math.random() * 1000;
                    const startTime = performance.now();
                    
                    // 动画函数
                    function animatePhoto(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        // 使用缓动函数使动画更自然
                        const easeProgress = 1 - Math.pow(1 - progress, 3);
                        
                        // 更新位置
                        photo.position.x = randomX + (targetX - randomX) * easeProgress;
                        photo.position.y = randomY + (targetY - randomY) * easeProgress;
                        photo.position.z = randomZ + (targetZ - randomZ) * easeProgress;
                        
                        // 面向球心
                        photo.lookAt(sphereGroup.position);
                        
                        // 更新透明度
                        photo.material.opacity = easeProgress;
                        
                        if (progress < 1) {
                            requestAnimationFrame(animatePhoto);
                        }
                    }
                    
                    requestAnimationFrame(animatePhoto);
                }, delay);
            }
            
            // 更新照片计数显示
            document.getElementById('photo-count').textContent = totalPhotos;
        }
        
        // 窗口大小调整
        function onWindowResize() {
            const container = document.getElementById('photo-sphere-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // 动画循环 - 针对iOS设备优化性能
        function animate() {
            // 针对iOS使用requestAnimationFrame优化
            if (isIOS) {
                requestAnimationFrame(animate);
            } else {
                // 非iOS设备使用setTimeout控制帧率
                setTimeout(animate, 16);
            }
            
            // 如果启用旋转，则旋转照片球
            if (isRotating) {
                sphereGroup.rotation.y += rotationSpeed;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // 照片点击事件 - 优化触摸设备体验
        function onPhotoClick(event) {
            // 过滤掉触摸事件的额外触发
            if (event.touches && event.touches.length > 0) return;
            
            // 计算点击位置
            const container = document.getElementById('photo-sphere-container');
            const rect = container.getBoundingClientRect();
            const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            // 创建射线投射器
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(x, y), camera);
            
            // 检测射线与照片的交点
            const intersects = raycaster.intersectObjects(photoSpheres);
            
            if (intersects.length > 0) {
                // 显示照片详情
                const photo = intersects[0].object;
                currentPhotoIndex = photo.userData.index;
                
                document.getElementById('view-photo').src = photo.userData.url;
                document.getElementById('photo-caption').textContent = photo.userData.caption;
                document.getElementById('photo-date').textContent = photo.userData.date;
                
                document.getElementById('photo-view-modal').classList.add('active');
                
                // 暂停旋转
                const wasRotating = isRotating;
                isRotating = false;
                document.getElementById('toggle-rotation').innerHTML = '<i class="fa fa-play mr-1"></i> 开始旋转';
                
                // 关闭弹窗时恢复旋转状态
                const closeBtn = document.getElementById('close-photo-modal');
                const originalOnClick = closeBtn.onclick;
                closeBtn.onclick = function() {
                    document.getElementById('photo-view-modal').classList.remove('active');
                    isRotating = wasRotating;
                    document.getElementById('toggle-rotation').innerHTML = isRotating ? 
                        '<i class="fa fa-pause mr-1"></i> 暂停旋转' : 
                        '<i class="fa fa-play mr-1"></i> 开始旋转';
                    closeBtn.onclick = originalOnClick;
                };
            }
        }
        
        // 重新汇聚动画
        function restartGatherAnimation() {
            document.getElementById('loading-overlay').style.display = 'flex';
            document.getElementById('loading-overlay').style.opacity = 1;
            
            setTimeout(() => {
                createPhotos();
                
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.opacity = 0;
                    setTimeout(() => {
                        document.getElementById('loading-overlay').style.display = 'none';
                    }, 500);
                }, 1000);
            }, 500);
        }
        
        // 页面切换功能 - 确保iOS设备完整显示
        function showSection(sectionId, hideSectionId, callback) {
            const hideSection = document.getElementById(hideSectionId);
            const showSection = document.getElementById(sectionId);
            
            // 隐藏当前页面
            if (hideSectionId === 'countdown-section') {
                hideSection.classList.add('opacity-0', 'translate-y-10');
            } else if (hideSectionId === 'photo-wall-section') {
                hideSection.classList.add('opacity-0', 'translate-y-10');
            } else if (hideSectionId === 'interaction-section') {
                hideSection.classList.add('opacity-0', 'rotate-1');
            } else if (hideSectionId === 'video-section') {
                hideSection.classList.add('opacity-0', 'scale-95');
            }
            
            // 显示新页面
            setTimeout(() => {
                hideSection.classList.add('hidden');
                showSection.classList.remove('hidden');
                
                // 确保页面滚动到顶部（iOS设备有时会保留滚动位置）
                window.scrollTo(0, 0);
                
                setTimeout(() => {
                    showSection.classList.remove('opacity-0', 'translate-y-10', 'rotate-1', 'scale-95');
                    if (callback) callback();
                }, 50);
            }, 500);
        }
        
        // 倒计时功能
        function startCountdown() {
            // 假设开始日期为2025年2月14日
            const startDate = new Date('2025-02-14T00:00:00');
            
            function updateCountdown() {
                const now = new Date();
                const diff = now - startDate;
                
                // 计算天、时、分、秒
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                // 更新DOM
                document.getElementById('days').textContent = days;
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }
            
            // 立即更新一次
            updateCountdown();
            // 每秒更新一次
            setInterval(updateCountdown, 1000);
        }
        
        // 计算下一个纪念日
        function calculateNextAnniversary() {
            const startDate = new Date('2025-02-14');
            const now = new Date();
            
            let nextAnniversary = new Date(startDate);
            nextAnniversary.setFullYear(now.getFullYear());
            
            // 如果今年的纪念日已经过了，计算明年的
            if (nextAnniversary < now) {
                nextAnniversary.setFullYear(now.getFullYear() + 1);
            }
            
            // 计算剩余天数
            const diffTime = nextAnniversary - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // 更新显示
            const anniversaryText = `距离我们${nextAnniversary.getFullYear() - 2025 + 1}周年纪念日还有 ${diffDays} 天`;
            document.getElementById('next-anniversary').textContent = anniversaryText;
        }
        
        // 创建漂浮爱心装饰 - iOS性能优化
        function createFloatingHearts() {
            const container = document.getElementById('floating-hearts');
            const colors = ['#FF9EBB', '#7CB9E8', '#2E86AB'];
            
            // iOS设备减少爱心数量，提升性能
            const heartCount = isIOS ? 10 : 30;
            
            for (let i = 0; i < heartCount; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.innerHTML = '<i class="fa fa-heart"></i>';
                    heart.className = 'absolute opacity-60 pointer-events-none';
                    heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                    heart.style.left = `${Math.random() * 100}vw`;
                    heart.style.top = '-20px';
                    heart.style.fontSize = `${8 + Math.random() * 16}px`;
                    
                    heart.style.animation = `
                        floatHeart ${5 + Math.random() * 10}s linear forwards,
                        sway ${2 + Math.random() * 4}s ease-in-out infinite alternate
                    `;
                    
                    container.appendChild(heart);
                    
                    // 移除过期的爱心
                    setTimeout(() => {
                        heart.remove();
                    }, 15000);
                }, i * 1000);
            }
            
            // 循环创建爱心
            setInterval(() => {
                const heart = document.createElement('div');
                heart.innerHTML = '<i class="fa fa-heart"></i>';
                heart.className = 'absolute opacity-60 pointer-events-none';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.left = `${Math.random() * 100}vw`;
                heart.style.top = '-20px';
                heart.style.fontSize = `${8 + Math.random() * 16}px`;
                
                heart.style.animation = `
                    floatHeart ${5 + Math.random() * 10}s linear forwards,
                    sway ${2 + Math.random() * 4}s ease-in-out infinite alternate
                `;
                
                container.appendChild(heart);
                
                // 移除过期的爱心
                setTimeout(() => {
                    heart.remove();
                }, 15000);
            }, 3000);
        }
        
        // 创建星光装饰
        function createStars() {
            const container = document.getElementById('stars');
            // iOS设备减少星星数量
            const starCount = isIOS ? 50 : 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'absolute rounded-full bg-white twinkle';
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                star.style.opacity = Math.random() * 0.5 + 0.2;
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                container.appendChild(star);
            }
        }
        
        // 初始化事件监听 - 优化触摸体验
        function initEventListeners() {
            // 密码相关
            document.getElementById('toggle-password').addEventListener('click', () => {
                const passwordInput = document.getElementById('password');
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // 切换图标
                document.getElementById('toggle-password').innerHTML = type === 'password' ? 
                    '<i class="fa fa-eye-slash text-lg"></i>' : 
                    '<i class="fa fa-eye text-lg"></i>';
            });
            
            // 密码提交（示例密码：20250214）
            document.getElementById('submit-password').addEventListener('click', () => {
                const password = document.getElementById('password').value;
                if (password === '20250214') {
                    // 密码正确，切换到倒计时页面
                    showSection('countdown-section', 'password-section', () => {
                        startCountdown();
                        calculateNextAnniversary();
                    });
                    
                    // 添加庆祝效果
                    createCelebration();
                } else {
                    // 密码错误，抖动效果
                    const input = document.getElementById('password');
                    input.classList.add('border-love');
                    input.classList.add('animate-shake');
                    setTimeout(() => {
                        input.classList.remove('animate-shake');
                    }, 500);
                }
            });
            
            // 密码提示
            document.getElementById('hint-btn').addEventListener('click', () => {
                document.getElementById('hint-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('modal-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            });
            
            document.getElementById('close-hint').addEventListener('click', () => {
                document.getElementById('modal-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('modal-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('hint-modal').classList.add('hidden');
                }, 300);
            });
            
            // 页面切换
            document.getElementById('to-photo-wall').addEventListener('click', () => {
                showSection('photo-wall-section', 'countdown-section', () => {
                    // 初始化3D照片墙
                    initPhotoSphere();
                });
            });
            
            document.getElementById('to-interaction').addEventListener('click', () => {
                showSection('interaction-section', 'photo-wall-section');
            });
            
            document.getElementById('to-video').addEventListener('click', () => {
                showSection('video-section', 'interaction-section');
            });
            
            document.getElementById('to-final').addEventListener('click', () => {
                showSection('final-section', 'video-section');
            });
            
            document.getElementById('restart-all').addEventListener('click', () => {
                // 重置所有状态并返回密码页
                document.getElementById('final-section').classList.add('hidden');
                document.getElementById('password-section').classList.remove('hidden');
                document.getElementById('password-section').classList.remove('opacity-0', 'translate-y-10');
                document.getElementById('password').value = '';
            });
            
            // 3D照片墙控制
            document.getElementById('reset-sphere').addEventListener('click', () => {
                // 重置视角
                camera.position.set(0, 0, 10);
                controls.reset();
            });
            
            document.getElementById('restart-animation').addEventListener('click', restartGatherAnimation);
            
            document.getElementById('toggle-rotation').addEventListener('click', () => {
                isRotating = !isRotating;
                document.getElementById('toggle-rotation').innerHTML = isRotating ? 
                    '<i class="fa fa-pause mr-1"></i> 暂停旋转' : 
                    '<i class="fa fa-play mr-1"></i> 开始旋转';
            });
            
            // 关闭照片查看弹窗
            document.getElementById('close-photo-modal').addEventListener('click', () => {
                document.getElementById('photo-view-modal').classList.remove('active');
            });
            
            // 照片上传
            document.getElementById('photo-upload').addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    // 这里可以处理上传的照片
                    alert(`已选择 ${files.length} 张照片，将添加到照片墙`);
                }
            });
            
            // 视频播放 - iOS支持内联播放
            document.getElementById('video-placeholder').addEventListener('click', () => {
                document.getElementById('video-placeholder').style.display = 'none';
                document.getElementById('special-video').play();
            });
            
            // 弹幕功能
            document.getElementById('send-danmaku').addEventListener('click', sendDanmaku);
            document.getElementById('danmaku-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendDanmaku();
                }
            });
            
            // 留言板功能
            document.getElementById('send-message').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // 表情按钮
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('message-input').value += btn.dataset.emoji;
                    document.getElementById('message-input').focus();
                });
            });
            
            // 问答功能
            document.getElementById('submit-answer').addEventListener('click', checkAnswer);
            document.getElementById('answer-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
            
            document.getElementById('hint-question').addEventListener('click', () => {
                document.getElementById('question-hint-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('question-hint-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('question-hint-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            });
            
            document.getElementById('close-question-hint').addEventListener('click', () => {
                document.getElementById('question-hint-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('question-hint-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('question-hint-modal').classList.add('hidden');
                }, 300);
            });
            
            document.getElementById('close-fail').addEventListener('click', () => {
                document.getElementById('fail-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('fail-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('fail-modal').classList.add('hidden');
                    // 解锁视频按钮
                    document.getElementById('to-video').disabled = false;
                }, 300);
            });
            
            // 头像上传
            document.getElementById('avatar1-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.querySelector('#countdown-section .rounded-full img').src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('avatar2-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.querySelectorAll('#countdown-section .rounded-full img')[1].src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // 发送弹幕
        function sendDanmaku() {
            const text = document.getElementById('danmaku-input').value.trim();
            if (text) {
                const danmaku = document.createElement('div');
                danmaku.className = 'absolute whitespace-nowrap text-shadow-soft';
                danmaku.textContent = text;
                
                // 随机样式
                const fontSize = 14 + Math.random() * 6;
                const top = Math.random() * (document.getElementById('video-danmaku').clientHeight - fontSize - 20);
                const color = `hsl(${Math.random() * 360}, 70%, 50%)`;
                
                danmaku.style.fontSize = `${fontSize}px`;
                danmaku.style.top = `${top}px`;
                danmaku.style.right = `-${danmaku.offsetWidth}px`;
                danmaku.style.color = color;
                danmaku.style.opacity = '0.8';
                
                document.getElementById('video-danmaku').appendChild(danmaku);
                
                // 动画效果
                const duration = 8 + Math.random() * 7;
                danmaku.style.transition = `transform ${duration}s linear`;
                setTimeout(() => {
                    danmaku.style.transform = `translateX(-${document.getElementById('video-danmaku').clientWidth + danmaku.offsetWidth}px)`;
                }, 10);
                
                // 移除弹幕
                setTimeout(() => {
                    danmaku.remove();
                }, duration * 1000);
                
                document.getElementById('danmaku-input').value = '';
            }
        }
        
        // 发送留言
        function sendMessage() {
            const message = document.getElementById('message-input').value.trim();
            if (message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'bg-light p-4 rounded-xl text-gray-700 opacity-0';
                
                // 格式化当前时间
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                messageElement.innerHTML = `
                    <p>${message}</p>
                    <div class="text-right text-xs text-gray-500/70 mt-1">${timeString}</div>
                `;
                
                document.getElementById('messages-container').prepend(messageElement);
                document.getElementById('message-input').value = '';
                
                // 滚动到底部
                document.getElementById('messages-container').scrollTop = 0;
                
                // 添加淡入动画
                setTimeout(() => {
                    messageElement.style.transition = 'all 0.5s ease-out';
                    messageElement.style.opacity = '1';
                }, 10);
            }
        }
        
        // 检查答案
        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswers = ['玫瑰', '玫瑰花', 'rose'];
            
            if (correctAnswers.some(ans => userAnswer.includes(ans))) {
                // 答案正确
                document.getElementById('answer-feedback').textContent = "太棒了，答对了！";
                document.getElementById('answer-feedback').className = "p-3 rounded-lg mb-4 bg-green-100 text-green-700";
                document.getElementById('answer-feedback').style.display = 'block';
                
                // 解锁视频按钮
                document.getElementById('to-video').disabled = false;
                
                // 添加庆祝效果
                createCelebration();
            } else {
                // 答案错误
                document.getElementById('fail-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('fail-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('fail-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            }
        }
        
        // 创建庆祝效果
        function createCelebration() {
            const container = document.createElement('div');
            container.className = 'fixed inset-0 pointer-events-none z-50';
            document.body.appendChild(container);
            
            const colors = ['#FF9EBB', '#7CB9E8', '#2E86AB', '#F0F8FF'];
            const count = isIOS ? 20 : 50;
            
            for (let i = 0; i < count; i++) {
                const heart = document.createElement('div');
                heart.innerHTML = '<i class="fa fa-heart"></i>';
                heart.className = 'absolute';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.left = `${50 + (Math.random() - 0.5) * 40}vw`;
                heart.style.top = `${50 + (Math.random() - 0.5) * 40}vh`;
                heart.style.fontSize = `${12 + Math.random() * 16}px`;
                heart.style.opacity = '0';
                
                container.appendChild(heart);
                
                // 动画效果
                setTimeout(() => {
                    heart.style.transition = 'all 1s ease-out';
                    heart.style.opacity = '0.8';
                    heart.style.transform = `translateY(${(Math.random() - 0.5) * 200}px) rotate(${Math.random() * 360}deg)`;
                }, 10);
                
                // 淡出效果
                setTimeout(() => {
                    heart.style.transition = 'all 0.5s ease-out';
                    heart.style.opacity = '0';
                }, 1000);
                
                // 移除元素
                setTimeout(() => {
                    heart.remove();
                }, 1500);
            }
            
            // 移除容器
            setTimeout(() => {
                container.remove();
            }, 2000);
        }
        
        // 添加全局动画样式
        function addGlobalStyles() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
                @keyframes floatHeart {
                    to {
                        transform: translateY(120vh) rotate(720deg);
                        opacity: 0;
                    }
                }
                @keyframes sway {
                    from { transform: translateX(-15px); }
                    to { transform: translateX(15px); }
                }
                .animate-shake {
                    animation: shake 0.5s ease-in-out;
                }
                .trans-1 { transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
                .trans-2 { transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); }
                .trans-3 { transition: all 0.7s cubic-bezier(0.22, 1, 0.36, 1); }
                .trans-4 { transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); }
                .trans-5 { transition: all 0.9s cubic-bezier(0.34, 1.56, 0.64, 1); }
                .scrollbar-thin {
                    scrollbar-width: thin;
                }
                .scrollbar-thumb-secondary\/30::-webkit-scrollbar-thumb {
                    background-color: rgba(124, 185, 232, 0.3);
                    border-radius: 4px;
                }
                .scrollbar-thumb-secondary\/30::-webkit-scrollbar {
                    width: 4px;
                }
                /* iOS滚动行为优化 */
                ::-webkit-scrollbar {
                    width: 6px;
                    height: 6px;
                }
                ::-webkit-scrollbar-track {
                    background: transparent;
                }
                ::-webkit-scrollbar-thumb {
                    background-color: rgba(124, 185, 232, 0.3);
                    border-radius: 3px;
                }
            `;
            document.head.appendChild(style);
        }
        
        // 初始化
        function init() {
            addGlobalStyles();
            initEventListeners();
            createFloatingHearts();
            createStars();
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', init);
    </script>
</body>
</html>
