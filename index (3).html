<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è‹¹æœè®¾å¤‡è§†å£ä¼˜åŒ– -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>è“è‰²æµªæ¼« Â· æ—¶å…‰è®°å¿†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Three.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    <!-- å¼•å…¥åœ†æ¶¦å­—ä½“å¢å¼ºæ¸©é¦¨æ„Ÿ -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C6E5FF',    // æµ…å¤©è“
                        secondary: '#7CB9E8',   // æ·¡è“
                        accent: '#2E86AB',     // æ·±æµ·è“
                        light: '#F0F8FF',      // æ·¡è“ç™½
                        love: '#FF9EBB',       // æ·¡ç²‰
                        overlay: 'rgba(240, 248, 255, 0.92)'
                    },
                    fontFamily: {
                        sans: ['"Nunito"', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'romantic': '0 8px 24px -4px rgba(124, 185, 232, 0.2)',
                        'romantic-lg': '0 16px 36px -6px rgba(46, 134, 171, 0.15)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow-soft {
                text-shadow: 0 2px 4px rgba(46, 134, 171, 0.1);
            }
            .bg-blur {
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px); /* è‹¹æœè®¾å¤‡å…¼å®¹ */
            }
            /* è‹¹æœè®¾å¤‡è§¦æ‘¸ä¼˜åŒ– */
            .touch-friendly {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .ios-button {
                -webkit-appearance: none;
                appearance: none;
            }
            /* å®‰å…¨åŒºåŸŸé€‚é… */
            .safe-area-inset-top {
                padding-top: env(safe-area-inset-top);
            }
            .safe-area-inset-bottom {
                padding-bottom: env(safe-area-inset-bottom);
            }
            /* 3Dç…§ç‰‡å¢™å®¹å™¨ - å“åº”å¼é«˜åº¦ */
            #photo-sphere-container {
                width: 100%;
                height: 55vh; /* æ‰‹æœºé»˜è®¤é«˜åº¦ */
            }
            @media (min-width: 768px) { /* iPadå°ºå¯¸ */
                #photo-sphere-container {
                    height: 65vh;
                }
            }
            /* ç…§ç‰‡æŸ¥çœ‹å¼¹çª— */
            .photo-modal {
                opacity: 0;
                visibility: hidden;
                transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                transform: scale(0.9);
            }
            .photo-modal.active {
                opacity: 1;
                visibility: visible;
                transform: scale(1);
            }
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse-love {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.15); opacity: 1; }
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-light via-primary to-secondary/20 min-h-screen font-sans text-accent overflow-x-hidden touch-friendly safe-area-inset-top safe-area-inset-bottom">
    <!-- å…¨å±€æµªæ¼«è£…é¥°ï¼šæ¼‚æµ®å°çˆ±å¿ƒ -->
    <div id="floating-hearts" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- å…¨å±€æµªæ¼«è£…é¥°ï¼šæ˜Ÿå…‰ç‚¹ç¼€ -->
    <div id="stars" class="fixed inset-0 pointer-events-none z-0"></div>

    <!-- 1. å¯†ç é¡µé¢ -->
    <section id="password-section" class="min-h-screen flex items-center justify-center p-4 relative trans-1">
        <div class="absolute inset-0 overflow-hidden z-0">
            <div class="absolute top-[15%] left-[10%] w-48 h-48 bg-secondary/10 rounded-full blur-2xl float-slow"></div>
            <div class="absolute bottom-[25%] right-[15%] w-64 h-64 bg-love/5 rounded-full blur-2xl float-medium"></div>
        </div>
        
        <div class="bg-white/90 bg-blur rounded-3xl shadow-romantic-lg p-6 sm:p-8 md:p-12 w-full max-w-md transform hover:scale-[1.02] transition-all duration-500 relative z-10">
            <div class="text-center mb-8">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-12 h-0.5 bg-secondary/40 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love text-xl"></i>
                    <span class="w-12 h-0.5 bg-secondary/40 rounded-full"></span>
                </div>
                <h1 class="text-[clamp(1.6rem,5vw,2.6rem)] font-bold text-accent mb-3 text-shadow-soft">æˆ‘ä»¬çš„ç§˜å¯†èŠ±å›­</h1>
                <p class="text-gray-600/70 text-sm sm:text-base">è¾“å…¥å¯†ç ï¼Œå¼€å¯ä¸“å±æµªæ¼«å›å¿†</p>
            </div>
            
            <div class="mb-7">
                <label for="password" class="block text-sm font-medium text-gray-600/80 mb-2">çˆ±çš„å¯†ç </label>
                <div class="relative">
                    <input type="password" id="password" class="w-full px-4 py-3.5 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 text-lg bg-light/60 placeholder-gray-400/70 ios-button" placeholder="ä¾‹å¦‚ï¼šæˆ‘ä»¬çš„çºªå¿µæ—¥">
                    <button id="toggle-password" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500/70 hover:text-accent transition-all duration-300 touch-friendly">
                        <i class="fa fa-eye-slash text-lg"></i>
                    </button>
                </div>
            </div>
            
            <button id="submit-password" class="w-full bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-6 rounded-xl shadow-romantic hover:shadow-lg transition-all duration-300 flex items-center justify-center group mb-5 ios-button touch-friendly">
                <span>è¿›å…¥å›å¿†</span>
                <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
            
            <div class="text-center">
                <button id="hint-btn" class="text-secondary hover:text-accent text-sm font-medium transition-all duration-300 flex items-center justify-center group touch-friendly">
                    <i class="fa fa-lightbulb-o mr-1 text-love group-hover:scale-110 transition-transform"></i>
                    <span>éœ€è¦å¯†ç æç¤ºå—ï¼Ÿ</span>
                </button>
            </div>
        </div>
    </section>

    <!-- å¯†ç æç¤ºå¼¹çª— -->
    <div id="hint-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="modal-content">
            <div class="text-center mb-6">
                <i class="fa fa-heart text-love text-3xl mb-3 pulse-love"></i>
                <h3 class="text-xl font-bold text-accent mb-2">å¯†ç æç¤º</h3>
                <p class="text-gray-600/80">æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç¡®å®šå…³ç³»çš„é‚£ä¸€å¤©ï¼ˆæ ¼å¼ï¼šYYYYMMDDï¼‰</p>
            </div>
            <button id="close-hint" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                æˆ‘çŸ¥é“äº†
            </button>
        </div>
    </div>

    <!-- 2. å€’è®¡æ—¶é¡µé¢ -->
    <section id="countdown-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-1 hidden opacity-0 translate-y-10">
        <!-- å¤´åƒ+çˆ±å¿ƒè£…é¥° -->
        <div class="flex items-center justify-center mb-10 w-full max-w-lg px-4">
            <!-- å·¦ä¾§å¤´åƒ -->
            <div class="relative group">
                <div class="w-20 h-20 sm:w-24 sm:h-24 md:w-32 md:h-32 rounded-full overflow-hidden border-4 border-white/90 shadow-romantic">
                    <img src="https://picsum.photos/seed/avatar1/300/300" alt="ä½ çš„å¤´åƒ" class="w-full h-full object-cover">
                </div>
                <label for="avatar1-upload" class="absolute -bottom-2 -right-2 bg-secondary/90 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-all duration-300 shadow-md touch-friendly">
                    <i class="fa fa-camera"></i>
                </label>
                <input type="file" id="avatar1-upload" accept="image/*" class="hidden">
            </div>
            
            <!-- ä¸­é—´çˆ±å¿ƒ -->
            <div class="mx-3 sm:mx-4 md:mx-8">
                <div class="text-3xl sm:text-4xl md:text-5xl text-transparent bg-clip-text bg-gradient-to-r from-love to-secondary pulse-love">
                    <i class="fa fa-heart"></i>
                </div>
            </div>
            
            <!-- å³ä¾§å¤´åƒ -->
            <div class="relative group">
                <div class="w-20 h-20 sm:w-24 sm:h-24 md:w-32 md:h-32 rounded-full overflow-hidden border-4 border-white/90 shadow-romantic">
                    <img src="https://picsum.photos/seed/avatar2/300/300" alt="å¯¹æ–¹çš„å¤´åƒ" class="w-full h-full object-cover">
                </div>
                <label for="avatar2-upload" class="absolute -bottom-2 -right-2 bg-secondary/90 text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-all duration-300 shadow-md touch-friendly">
                    <i class="fa fa-camera"></i>
                </label>
                <input type="file" id="avatar2-upload" accept="image/*" class="hidden">
            </div>
        </div>
        
        <!-- å€’è®¡æ—¶å¡ç‰‡ -->
        <div class="text-center mb-12 px-4">
            <h2 class="text-[clamp(1.5rem,6vw,3rem)] font-bold text-accent mb-6 text-shadow-soft">æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ·</h2>
            <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 md:p-10 inline-block w-full max-w-md">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6">
                    <div class="text-center">
                        <div id="days" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">å¤©</div>
                    </div>
                    <div class="text-center">
                        <div id="hours" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">æ—¶</div>
                    </div>
                    <div class="text-center">
                        <div id="minutes" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">åˆ†</div>
                    </div>
                    <div class="text-center">
                        <div id="seconds" class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent">0</div>
                        <div class="text-xs sm:text-sm text-gray-600/70 mt-1">ç§’</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çºªå¿µæ—¥æé†’ -->
        <div class="bg-white/90 bg-blur rounded-xl shadow-romantic p-5 sm:p-6 mb-10 max-w-md w-full text-center">
            <h3 class="font-bold text-lg mb-2 text-accent flex items-center">
                <i class="fa fa-calendar text-secondary mr-2"></i>ä¸‹ä¸€ä¸ªçºªå¿µæ—¥
            </h3>
            <p id="next-anniversary" class="text-gray-600/80 text-sm sm:text-base"></p>
        </div>
        
        <!-- è¿›å…¥ç…§ç‰‡å¢™æŒ‰é’® -->
        <button id="to-photo-wall" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group ios-button touch-friendly">
            æŸ¥çœ‹æˆ‘ä»¬çš„ç…§ç‰‡çƒ
            <i class="fa fa-picture-o ml-2 group-hover:rotate-12 transition-transform"></i>
        </button>
    </section>

    <!-- 3. 3Dçƒå½¢ç…§ç‰‡å¢™é¡µé¢ -->
    <section id="photo-wall-section" class="min-h-screen p-4 sm:p-6 md:p-8 trans-2 hidden opacity-0 translate-y-10">
        <div class="max-w-7xl mx-auto">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="text-center mb-8 sm:mb-10">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love"></i>
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                </div>
                <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-3 text-shadow-soft">æˆ‘ä»¬çš„å›å¿†æ˜Ÿçƒ</h2>
                <p class="text-gray-600/70 max-w-2xl mx-auto text-sm sm:text-base">
                    82å¼ ç…§ç‰‡ç»„æˆçš„æµªæ¼«æ˜Ÿçƒï¼Œç‚¹å‡»å¯æ”¾å¤§æŸ¥çœ‹ï¼ŒåŒæŒ‡ç¼©æ”¾æˆ–æ‹–åŠ¨æ—‹è½¬
                </p>
            </div>
            
            <!-- ç…§ç‰‡å¢™æ§åˆ¶æ  -->
            <div class="flex flex-wrap justify-center gap-3 sm:gap-4 mb-6">
                <button id="reset-sphere" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-refresh mr-1"></i> é‡ç½®è§†è§’
                </button>
                <button id="restart-animation" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-repeat mr-1"></i> é‡æ–°æ±‡èš
                </button>
                <button id="toggle-rotation" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm ios-button touch-friendly">
                    <i class="fa fa-pause mr-1"></i> æš‚åœæ—‹è½¬
                </button>
                <label for="photo-upload" class="bg-white/80 hover:bg-white text-accent font-medium py-2.5 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-300 flex items-center text-sm cursor-pointer ios-button touch-friendly">
                    <i class="fa fa-upload mr-1"></i> ä¸Šä¼ ç…§ç‰‡
                </label>
                <input type="file" id="photo-upload" accept="image/*" multiple class="hidden">
            </div>
            
            <!-- 3Dçƒå½¢ç…§ç‰‡å¢™å®¹å™¨ -->
            <div id="photo-sphere-container" class="mb-8 touch-friendly" touch-action="none">
                <!-- Three.jsæ¸²æŸ“å†…å®¹å°†æ’å…¥è¿™é‡Œ -->
                <div class="absolute inset-0 flex items-center justify-center z-10" id="loading-overlay">
                    <div class="text-center">
                        <div class="w-12 h-12 border-4 border-secondary/30 border-t-secondary rounded-full animate-spin mx-auto mb-4"></div>
                        <p class="text-accent/80">ç…§ç‰‡æ˜ŸçƒåŠ è½½ä¸­...</p>
                    </div>
                </div>
            </div>
            
            <!-- æ“ä½œæç¤º -->
            <div class="bg-white/80 bg-blur rounded-xl shadow-romantic p-4 sm:p-5 max-w-2xl mx-auto text-center">
                <p class="text-gray-600/80 text-sm sm:text-base flex items-center justify-center gap-2 flex-wrap">
                    <i class="fa fa-hand-pointer-o text-secondary"></i> æ‹–æ‹½æ—‹è½¬æ˜Ÿçƒ 
                    <span class="inline-block w-1 h-1 bg-secondary/40 rounded-full hidden sm:inline-block"></span> 
                    <i class="fa fa-arrows-alt text-secondary"></i> åŒæŒ‡ç¼©æ”¾ 
                    <span class="inline-block w-1 h-1 bg-secondary/40 rounded-full hidden sm:inline-block"></span> 
                    <i class="fa fa-image text-secondary"></i> ç‚¹å‡»æŸ¥çœ‹ç…§ç‰‡
                </p>
            </div>
            
            <!-- è¿›å…¥äº’åŠ¨ç¯èŠ‚æŒ‰é’® -->
            <div class="text-center mt-10">
                <button id="to-interaction" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group mx-auto ios-button touch-friendly">
                    ç»§ç»­äº’åŠ¨ä¹‹æ—…
                    <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- ç…§ç‰‡æŸ¥çœ‹å¼¹çª— -->
    <div class="photo-modal fixed inset-0 bg-overlay bg-blur flex items-center justify-center p-4 z-50" id="photo-view-modal">
        <div class="relative max-w-2xl w-full max-h-[90vh]">
            <button id="close-photo-modal" class="absolute -top-12 right-0 text-accent/80 hover:text-accent transition-all duration-300 text-2xl touch-friendly">
                <i class="fa fa-times"></i>
            </button>
            <div class="bg-white rounded-xl shadow-romantic-lg overflow-hidden">
                <div class="p-1 bg-light">
                    <img id="view-photo" src="" alt="æŸ¥çœ‹ç…§ç‰‡" class="w-full h-auto max-h-[70vh] object-contain">
                </div>
                <div class="p-4 sm:p-5 text-center">
                    <h4 id="photo-caption" class="font-medium text-accent">ç…§ç‰‡å›å¿†</h4>
                    <p id="photo-date" class="text-gray-500/70 text-sm mt-1">æ‹æ‘„æ—¥æœŸ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. äº’åŠ¨é—®ç­”é¡µé¢ -->
    <section id="interaction-section" class="min-h-screen p-4 sm:p-6 md:p-8 trans-3 hidden opacity-0 rotate-1">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-8 sm:mb-12">
                <div class="flex justify-center items-center gap-3 mb-4">
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                    <i class="fa fa-heart text-love pulse-love"></i>
                    <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                </div>
                <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-3 text-shadow-soft">çˆ±çš„äº’åŠ¨ç©ºé—´</h2>
                <p class="text-gray-600/70 text-sm sm:text-base">åœ¨è¿™é‡Œç•™ä¸‹ä½ æƒ³å¯¹æˆ‘è¯´çš„è¯</p>
            </div>
            
            <!-- å“åº”å¼ç½‘æ ¼å¸ƒå±€ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 mb-10">
                <!-- çˆ±çš„é—®ç­”ç¯èŠ‚ -->
                <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic p-5 sm:p-6 md:p-8 transform hover:-translate-y-1 transition-all duration-300">
                    <h3 class="font-bold text-lg sm:text-xl mb-5 text-accent flex items-center">
                        <i class="fa fa-question-circle text-secondary mr-2"></i>
                        çˆ±çš„é—®ç­”
                    </h3>
                    
                    <div id="quiz-container" class="mb-5">
                        <div class="question-text text-base sm:text-lg font-medium mb-4 text-accent/90">æˆ‘æœ€å–œæ¬¢çš„èŠ±æ˜¯ä»€ä¹ˆï¼Ÿ</div>
                        <div class="mb-4">
                            <input type="text" id="answer-input" class="w-full px-4 py-3 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 bg-light/50 ios-button" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ...">
                        </div>
                        <div class="flex flex-wrap justify-between items-center gap-2 mb-4">
                            <button id="hint-question" class="text-secondary hover:text-accent text-sm font-medium transition-all duration-300 flex items-center touch-friendly">
                                <i class="fa fa-lightbulb-o mr-1 text-love"></i>
                                <span>æç¤º</span>
                            </button>
                            <button id="cant-guess" class="text-gray-500/80 hover:text-gray-700 text-sm font-medium transition-all duration-300 flex items-center touch-friendly">
                                <span>æˆ‘è¿˜çŒœä¸å‡ºæ¥</span>
                            </button>
                        </div>
                        <div id="answer-feedback" class="hidden p-3 rounded-lg mb-4"></div>
                    </div>
                    
                    <button id="submit-answer" class="w-full bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3 px-6 rounded-xl shadow-sm hover:shadow transition-all duration-300 ios-button touch-friendly">
                        æäº¤ç­”æ¡ˆ
                    </button>
                </div>
                
                <!-- ç•™è¨€æ¿ -->
                <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic p-5 sm:p-6 md:p-8 transform hover:-translate-y-1 transition-all duration-300">
                    <h3 class="font-bold text-lg sm:text-xl mb-5 text-accent flex items-center">
                        <i class="fa fa-pencil-square-o text-secondary mr-2"></i>
                        äº’åŠ¨ç•™è¨€æ¿
                    </h3>
                    
                    <div class="mb-5">
                        <textarea id="message-input" rows="4" class="w-full px-4 py-3 rounded-xl border border-secondary/30 focus:ring-2 focus:ring-secondary focus:border-transparent transition-all duration-300 bg-light/50 resize-none ios-button" placeholder="å†™ä¸‹ä½ æƒ³å¯¹æˆ‘è¯´çš„è¯..."></textarea>
                        <div class="flex mt-2 justify-end gap-2">
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="â¤ï¸">â¤ï¸</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="ğŸ˜">ğŸ˜</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="ğŸ’•">ğŸ’•</button>
                            <button class="emoji-btn text-gray-500/70 hover:text-love p-2 rounded-full hover:bg-primary/20 transition-all duration-300 touch-friendly" data-emoji="ğŸ’Œ">ğŸ’Œ</button>
                        </div>
                    </div>
                    
                    <button id="send-message" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3 px-6 rounded-xl shadow-sm hover:shadow transition-all duration-300 flex items-center justify-center group ios-button touch-friendly">
                        <i class="fa fa-paper-plane mr-2 group-hover:translate-x-1 transition-transform"></i> å‘é€
                    </button>
                    
                    <div id="messages-container" class="mt-6 sm:mt-8 space-y-3 max-h-64 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-secondary/30">
                        <div class="bg-light p-4 rounded-xl text-gray-700 animate-fadeIn">
                            <p>è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€æ¡ç•™è¨€ï¼Œå¼€å§‹æˆ‘ä»¬çš„äº’åŠ¨å§ï¼</p>
                            <div class="text-right text-xs text-gray-500/70 mt-1">åˆšåˆš</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button id="to-video" class="bg-gradient-to-r from-love/80 to-love text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 pulse-love ios-button touch-friendly" disabled>
                    æœ€åçš„æƒŠå–œ
                    <i class="fa fa-film ml-2"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- 5. è§†é¢‘é¡µé¢ -->
    <section id="video-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-4 hidden opacity-0 scale-95">
        <div class="text-center mb-8 sm:mb-12 px-4 max-w-3xl">
            <div class="flex justify-center items-center gap-3 mb-4">
                <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
                <i class="fa fa-heart text-love pulse-love"></i>
                <span class="w-16 h-0.5 bg-secondary/30 rounded-full"></span>
            </div>
            <h2 class="text-[clamp(1.5rem,5vw,2.8rem)] font-bold text-accent mb-4 text-shadow-soft">ç»™ä½ çš„ç‰¹åˆ«ç¤¼ç‰©</h2>
            <p class="text-gray-600/70 text-sm sm:text-base">è¿™æ˜¯æˆ‘ä¸ºä½ å‡†å¤‡çš„è§†é¢‘ï¼Œè®°å½•äº†æˆ‘ä»¬åœ¨ä¸€èµ·çš„ç¾å¥½æ—¶å…‰ï¼Œç‚¹å‡»æ’­æ”¾ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å›å¿†è¿™äº›çè´µçš„ç¬é—´ã€‚</p>
        </div>
        
        <div class="relative w-full max-w-3xl bg-light rounded-2xl overflow-hidden shadow-romantic-lg">
            <video id="special-video" class="w-full aspect-video object-cover" poster="https://picsum.photos/seed/videoposter/1200/675" controls playsinline>
                <source src="your-video.mp4" type="video/mp4">
                ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
            </audio>
            
            <div id="video-placeholder" class="absolute inset-0 flex items-center justify-center cursor-pointer bg-gradient-to-tr from-secondary/40 to-accent/40 touch-friendly">
                <div class="text-center p-6">
                    <i class="fa fa-play-circle text-white text-5xl sm:text-6xl mb-4 opacity-90 hover:opacity-100 transition-all duration-300 pulse-love"></i>
                    <p class="text-white text-base sm:text-xl font-medium text-shadow-soft">ç‚¹å‡»æ’­æ”¾æˆ‘ä»¬çš„å›å¿†</p>
                </div>
            </div>
            
            <!-- è§†é¢‘å¼¹å¹•å®¹å™¨ -->
            <div id="video-danmaku" class="absolute inset-0 overflow-hidden pointer-events-none"></div>
            <!-- å¼¹å¹•è¾“å…¥ -->
            <div class="absolute bottom-20 left-0 right-0 px-4 flex">
                <input type="text" id="danmaku-input" placeholder="å‘é€å¼¹å¹•..." class="flex-1 bg-black/30 text-white px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-white/50 placeholder-white/60 ios-button">
                <button id="send-danmaku" class="ml-2 bg-white/30 hover:bg-white/40 text-white px-4 py-2 rounded-full transition-all duration-300 ios-button touch-friendly">
                    å‘é€
                </button>
            </div>
        </div>
        
        <div class="mt-10 sm:mt-14 text-center px-4 max-w-2xl">
            <p class="text-gray-700 italic text-sm sm:text-base mb-6">"æˆ‘çˆ±ä½ ï¼Œä¸ä»…å› ä¸ºä½ æ˜¯è°ï¼Œè¿˜å› ä¸ºå’Œä½ åœ¨ä¸€èµ·æ—¶æˆ‘æ˜¯è°ã€‚"</p>
            <p class="text-accent font-medium text-lg">æ°¸è¿œçˆ±ä½ çš„äºº</p>
            
            <button id="to-final" class="mt-8 bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center group mx-auto ios-button touch-friendly">
                æœ€åä¸€é¡µ
                <i class="fa fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </section>

    <!-- 6. æœ€ç»ˆé¡µé¢ -->
    <section id="final-section" class="min-h-screen flex flex-col items-center justify-center p-4 trans-5 hidden">
        <div class="max-w-4xl mx-auto text-center px-4">
            <div class="mb-10">
                <i class="fa fa-heart text-6xl sm:text-7xl text-love pulse-love"></i>
            </div>
            
            <h2 class="text-[clamp(1.8rem,6vw,3.2rem)] font-bold text-accent mb-6 text-shadow-soft">æˆ‘çˆ±ä½ </h2>
            
            <div class="bg-white/90 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 md:p-10 mb-10">
                <p class="text-gray-700 text-base sm:text-lg leading-relaxed mb-6">
                    ä»é‡è§ä½ çš„é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘çš„å¿ƒå°±ä¸ºä½ è€Œè·³åŠ¨ã€‚æ¯ä¸€ä¸ªä¸ä½ å…±åº¦çš„ç¬é—´ï¼Œéƒ½æˆä¸ºäº†æˆ‘ç”Ÿå‘½ä¸­æœ€çè´µçš„å›å¿†ã€‚
                    è¿™82å¼ ç…§ç‰‡ï¼Œè®°å½•äº†æˆ‘ä»¬ä¸€è·¯èµ°æ¥çš„ç‚¹ç‚¹æ»´æ»´ï¼Œæœªæ¥è¿˜æœ‰æ›´å¤šçš„æ•…äº‹ç­‰ç€æˆ‘ä»¬ä¸€èµ·ä¹¦å†™ã€‚
                </p>
                <p class="text-gray-700 text-base sm:text-lg leading-relaxed">
                    è°¢è°¢ä½ å‡ºç°åœ¨æˆ‘çš„ç”Ÿå‘½é‡Œï¼Œè®©æ¯ä¸€å¤©éƒ½å……æ»¡äº†è‰²å½©å’Œæ„ä¹‰ã€‚æ— è®ºæœªæ¥å¦‚ä½•ï¼Œæˆ‘éƒ½ä¼šç‰µç€ä½ çš„æ‰‹ï¼Œä¸€èµ·èµ°ä¸‹å»ã€‚
                </p>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="restart-all" class="bg-gradient-to-r from-secondary to-accent text-white font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center justify-center group ios-button touch-friendly">
                    <i class="fa fa-refresh mr-2 group-hover:rotate-180 transition-transform"></i> é‡æ–°å¼€å§‹
                </button>
                <button id="download-photos" class="bg-white/90 hover:bg-white text-accent font-semibold py-3.5 px-8 rounded-full shadow-romantic hover:shadow-lg transition-all duration-300 text-base sm:text-lg transform hover:-translate-y-1 flex items-center justify-center group ios-button touch-friendly">
                    <i class="fa fa-download mr-2 group-hover:translate-y-1 transition-transform"></i> ä¿å­˜ç…§ç‰‡
                </button>
            </div>
        </div>
    </section>

    <!-- å„ç§å¼¹çª— -->
    <div id="question-hint-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="question-hint-content">
            <h3 class="text-xl font-bold text-center mb-4 text-accent">æç¤º</h3>
            <p class="text-center text-gray-600/80 mb-6" id="hint-text">æ˜¯ä¸€ç§ç²‰è‰²çš„èŠ±ï¼Œè±¡å¾çˆ±æƒ…</p>
            <button id="close-question-hint" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                æˆ‘çŸ¥é“äº†
            </button>
        </div>
    </div>

    <div id="fail-modal" class="fixed inset-0 bg-black/20 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white/95 bg-blur rounded-2xl shadow-romantic-lg p-6 sm:p-8 max-w-md w-full transform transition-all duration-400 scale-95 opacity-0" id="fail-content">
            <div class="text-center mb-4">
                <i class="fa fa-heart text-love text-3xl pulse-love"></i>
            </div>
            <h3 class="text-xl font-bold text-center mb-2 text-accent">æ­£ç¡®ç­”æ¡ˆ</h3>
            <p class="text-center text-gray-600/80 mb-6" id="correct-answer-text">æˆ‘æœ€å–œæ¬¢çš„æ˜¯ç«ç‘°èŠ±</p>
            <button id="close-fail" class="w-full bg-secondary hover:bg-accent text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 ios-button touch-friendly">
                çŸ¥é“äº†
            </button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let scene, camera, renderer, controls;
        let photoSpheres = [];
        let sphereGroup;
        let isRotating = true;
        let rotationSpeed = 0.003;
        const totalPhotos = 82; // 82å¼ ç…§ç‰‡
        let currentPhotoIndex = -1;
        let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

        // åˆå§‹åŒ–3Dçƒå½¢ç…§ç‰‡å¢™ - é’ˆå¯¹iOSä¼˜åŒ–æ€§èƒ½
        function initPhotoSphere() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f8ff);
            
            // æ·»åŠ ç¯å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            
            // æ·»åŠ æ–¹å‘å…‰
            const directionalLight = new THREE.DirectionalLight(0x7cb9e8, 0.6);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // åˆ›å»ºç›¸æœº
            camera = new THREE.PerspectiveCamera(75, document.getElementById('photo-sphere-container').clientWidth / document.getElementById('photo-sphere-container').clientHeight, 0.1, 1000);
            camera.position.z = 10;
            
            // åˆ›å»ºæ¸²æŸ“å™¨ - iOSæ€§èƒ½ä¼˜åŒ–
            renderer = new THREE.WebGLRenderer({ 
                antialias: isIOS ? false : true, // iOSå…³é—­æŠ—é”¯é½¿æå‡æ€§èƒ½
                powerPreference: "high-performance"
            });
            renderer.setSize(document.getElementById('photo-sphere-container').clientWidth, document.getElementById('photo-sphere-container').clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('photo-sphere-container').appendChild(renderer.domElement);
            
            // åˆ›å»ºæ§åˆ¶å™¨ - ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.3;
            controls.zoomSpeed = 0.5;
            controls.enablePan = false; // ç¦ç”¨å¹³ç§»ï¼Œé¿å…è§¦æ‘¸å†²çª
            
            // é’ˆå¯¹iOSè§¦æ‘¸ä¼˜åŒ–
            if (isIOS) {
                controls.touches.ONE = THREE.TOUCH.ROTATE;
                controls.touches.TWO = THREE.TOUCH.DOLLY_ROTATE;
                rotationSpeed = 0.002; // é™ä½æ—‹è½¬é€Ÿåº¦ï¼Œæ›´é€‚åˆè§¦æ‘¸è®¾å¤‡
            }
            
            // åˆ›å»ºç…§ç‰‡ç»„
            sphereGroup = new THREE.Group();
            scene.add(sphereGroup);
            
            // åˆ›å»º82å¼ ç…§ç‰‡
            createPhotos();
            
            // æ·»åŠ çª—å£å¤§å°ç›‘å¬
            window.addEventListener('resize', onWindowResize);
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
            window.addEventListener('click', onPhotoClick);
            
            // å¼€å§‹åŠ¨ç”»
            animate();
            
            // éšè—åŠ è½½æç¤º
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 500);
            }, 1500);
        }
        
        // åˆ›å»ºç…§ç‰‡ - ä¼˜åŒ–iOSåŠ è½½æ€§èƒ½
        function createPhotos() {
            // æ¸…é™¤ç°æœ‰ç…§ç‰‡
            while (sphereGroup.children.length > 0) {
                const child = sphereGroup.children[0];
                sphereGroup.remove(child);
            }
            photoSpheres = [];
            
            const radius = 5; // çƒåŠå¾„
            
            // ç”Ÿæˆå‡åŒ€åˆ†å¸ƒåœ¨çƒé¢ä¸Šçš„ç‚¹
            for (let i = 0; i < totalPhotos; i++) {
                // ä½¿ç”¨é»„é‡‘èºæ—‹ç®—æ³•ç”Ÿæˆå‡åŒ€åˆ†å¸ƒçš„ç‚¹
                const y = 1 - (i / (totalPhotos - 1)) * 2; // yä»1åˆ°-1
                const radius = Math.sqrt(1 - y * y); // åŠå¾„åœ¨yå¤„çš„åœ†
                
                const theta = Math.PI * 2 * i / 1.618033988749895; // é»„é‡‘è§’
                
                const x = Math.cos(theta) * radius;
                const z = Math.sin(theta) * radius;
                
                // åˆ›å»ºå¹³é¢å‡ ä½•ä½“ä½œä¸ºç…§ç‰‡è½½ä½“ - ç®€åŒ–å‡ ä½•ä½“æå‡iOSæ€§èƒ½
                const geometry = new THREE.PlaneGeometry(0.8, 0.8);
                
                // ä½¿ç”¨éšæœºå›¾ç‰‡ä½œä¸ºç¤ºä¾‹
                const textureLoader = new THREE.TextureLoader();
                // å›¾ç‰‡å°ºå¯¸ä¼˜åŒ–ï¼Œé€‚åˆiOSè®¾å¤‡
                const texture = textureLoader.load(`https://picsum.photos/seed/photo${i}/300/300`);
                
                // åˆ›å»ºæè´¨ - ä¼˜åŒ–é€æ˜åº¦åŠ¨ç”»æ€§èƒ½
                const material = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0
                });
                
                // åˆ›å»ºç½‘æ ¼
                const photo = new THREE.Mesh(geometry, material);
                
                // ä¿å­˜ç…§ç‰‡ä¿¡æ¯
                photo.userData = {
                    index: i,
                    url: `https://picsum.photos/seed/photo${i}/600/600`,
                    caption: `æˆ‘ä»¬çš„å›å¿† #${i+1}`,
                    date: `2025-${(Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0')}-${(Math.floor(Math.random() * 28) + 1).toString().padStart(2, '0')}`
                };
                
                // è®¾ç½®åˆå§‹ä½ç½®ï¼ˆåˆ†æ•£çŠ¶æ€ï¼‰
                const randomX = (Math.random() - 0.5) * 20;
                const randomY = (Math.random() - 0.5) * 20;
                const randomZ = (Math.random() - 0.5) * 20;
                photo.position.set(randomX, randomY, randomZ);
                
                // æ·»åŠ åˆ°ç»„
                sphereGroup.add(photo);
                photoSpheres.push(photo);
                
                // æ·»åŠ æ±‡èšåŠ¨ç”» - iOSè®¾å¤‡é™ä½åŠ¨ç”»å¤æ‚åº¦
                const delay = isIOS ? i * 50 : i * 30; // iOSå»¶è¿Ÿæ›´é•¿ï¼Œå‡å°‘åŒæ—¶åŠ¨ç”»æ•°é‡
                setTimeout(() => {
                    // ç›®æ ‡ä½ç½®ï¼ˆçƒé¢ä¸Šçš„ç‚¹ï¼‰
                    const targetX = x * radius;
                    const targetY = y * radius;
                    const targetZ = z * radius;
                    
                    // åŠ¨ç”»æ—¶é—´
                    const duration = isIOS ? 3000 + Math.random() * 1000 : 2000 + Math.random() * 1000;
                    const startTime = performance.now();
                    
                    // åŠ¨ç”»å‡½æ•°
                    function animatePhoto(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°ä½¿åŠ¨ç”»æ›´è‡ªç„¶
                        const easeProgress = 1 - Math.pow(1 - progress, 3);
                        
                        // æ›´æ–°ä½ç½®
                        photo.position.x = randomX + (targetX - randomX) * easeProgress;
                        photo.position.y = randomY + (targetY - randomY) * easeProgress;
                        photo.position.z = randomZ + (targetZ - randomZ) * easeProgress;
                        
                        // é¢å‘çƒå¿ƒ
                        photo.lookAt(sphereGroup.position);
                        
                        // æ›´æ–°é€æ˜åº¦
                        photo.material.opacity = easeProgress;
                        
                        if (progress < 1) {
                            requestAnimationFrame(animatePhoto);
                        }
                    }
                    
                    requestAnimationFrame(animatePhoto);
                }, delay);
            }
            
            // æ›´æ–°ç…§ç‰‡è®¡æ•°æ˜¾ç¤º
            document.getElementById('photo-count').textContent = totalPhotos;
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        function onWindowResize() {
            const container = document.getElementById('photo-sphere-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        // åŠ¨ç”»å¾ªç¯ - é’ˆå¯¹iOSè®¾å¤‡ä¼˜åŒ–æ€§èƒ½
        function animate() {
            // é’ˆå¯¹iOSä½¿ç”¨requestAnimationFrameä¼˜åŒ–
            if (isIOS) {
                requestAnimationFrame(animate);
            } else {
                // éiOSè®¾å¤‡ä½¿ç”¨setTimeoutæ§åˆ¶å¸§ç‡
                setTimeout(animate, 16);
            }
            
            // å¦‚æœå¯ç”¨æ—‹è½¬ï¼Œåˆ™æ—‹è½¬ç…§ç‰‡çƒ
            if (isRotating) {
                sphereGroup.rotation.y += rotationSpeed;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // ç…§ç‰‡ç‚¹å‡»äº‹ä»¶ - ä¼˜åŒ–è§¦æ‘¸è®¾å¤‡ä½“éªŒ
        function onPhotoClick(event) {
            // è¿‡æ»¤æ‰è§¦æ‘¸äº‹ä»¶çš„é¢å¤–è§¦å‘
            if (event.touches && event.touches.length > 0) return;
            
            // è®¡ç®—ç‚¹å‡»ä½ç½®
            const container = document.getElementById('photo-sphere-container');
            const rect = container.getBoundingClientRect();
            const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            // åˆ›å»ºå°„çº¿æŠ•å°„å™¨
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(new THREE.Vector2(x, y), camera);
            
            // æ£€æµ‹å°„çº¿ä¸ç…§ç‰‡çš„äº¤ç‚¹
            const intersects = raycaster.intersectObjects(photoSpheres);
            
            if (intersects.length > 0) {
                // æ˜¾ç¤ºç…§ç‰‡è¯¦æƒ…
                const photo = intersects[0].object;
                currentPhotoIndex = photo.userData.index;
                
                document.getElementById('view-photo').src = photo.userData.url;
                document.getElementById('photo-caption').textContent = photo.userData.caption;
                document.getElementById('photo-date').textContent = photo.userData.date;
                
                document.getElementById('photo-view-modal').classList.add('active');
                
                // æš‚åœæ—‹è½¬
                const wasRotating = isRotating;
                isRotating = false;
                document.getElementById('toggle-rotation').innerHTML = '<i class="fa fa-play mr-1"></i> å¼€å§‹æ—‹è½¬';
                
                // å…³é—­å¼¹çª—æ—¶æ¢å¤æ—‹è½¬çŠ¶æ€
                const closeBtn = document.getElementById('close-photo-modal');
                const originalOnClick = closeBtn.onclick;
                closeBtn.onclick = function() {
                    document.getElementById('photo-view-modal').classList.remove('active');
                    isRotating = wasRotating;
                    document.getElementById('toggle-rotation').innerHTML = isRotating ? 
                        '<i class="fa fa-pause mr-1"></i> æš‚åœæ—‹è½¬' : 
                        '<i class="fa fa-play mr-1"></i> å¼€å§‹æ—‹è½¬';
                    closeBtn.onclick = originalOnClick;
                };
            }
        }
        
        // é‡æ–°æ±‡èšåŠ¨ç”»
        function restartGatherAnimation() {
            document.getElementById('loading-overlay').style.display = 'flex';
            document.getElementById('loading-overlay').style.opacity = 1;
            
            setTimeout(() => {
                createPhotos();
                
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.opacity = 0;
                    setTimeout(() => {
                        document.getElementById('loading-overlay').style.display = 'none';
                    }, 500);
                }, 1000);
            }, 500);
        }
        
        // é¡µé¢åˆ‡æ¢åŠŸèƒ½ - ç¡®ä¿iOSè®¾å¤‡å®Œæ•´æ˜¾ç¤º
        function showSection(sectionId, hideSectionId, callback) {
            const hideSection = document.getElementById(hideSectionId);
            const showSection = document.getElementById(sectionId);
            
            // éšè—å½“å‰é¡µé¢
            if (hideSectionId === 'countdown-section') {
                hideSection.classList.add('opacity-0', 'translate-y-10');
            } else if (hideSectionId === 'photo-wall-section') {
                hideSection.classList.add('opacity-0', 'translate-y-10');
            } else if (hideSectionId === 'interaction-section') {
                hideSection.classList.add('opacity-0', 'rotate-1');
            } else if (hideSectionId === 'video-section') {
                hideSection.classList.add('opacity-0', 'scale-95');
            }
            
            // æ˜¾ç¤ºæ–°é¡µé¢
            setTimeout(() => {
                hideSection.classList.add('hidden');
                showSection.classList.remove('hidden');
                
                // ç¡®ä¿é¡µé¢æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼ˆiOSè®¾å¤‡æœ‰æ—¶ä¼šä¿ç•™æ»šåŠ¨ä½ç½®ï¼‰
                window.scrollTo(0, 0);
                
                setTimeout(() => {
                    showSection.classList.remove('opacity-0', 'translate-y-10', 'rotate-1', 'scale-95');
                    if (callback) callback();
                }, 50);
            }, 500);
        }
        
        // å€’è®¡æ—¶åŠŸèƒ½
        function startCountdown() {
            // å‡è®¾å¼€å§‹æ—¥æœŸä¸º2025å¹´2æœˆ14æ—¥
            const startDate = new Date('2025-02-14T00:00:00');
            
            function updateCountdown() {
                const now = new Date();
                const diff = now - startDate;
                
                // è®¡ç®—å¤©ã€æ—¶ã€åˆ†ã€ç§’
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                // æ›´æ–°DOM
                document.getElementById('days').textContent = days;
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }
            
            // ç«‹å³æ›´æ–°ä¸€æ¬¡
            updateCountdown();
            // æ¯ç§’æ›´æ–°ä¸€æ¬¡
            setInterval(updateCountdown, 1000);
        }
        
        // è®¡ç®—ä¸‹ä¸€ä¸ªçºªå¿µæ—¥
        function calculateNextAnniversary() {
            const startDate = new Date('2025-02-14');
            const now = new Date();
            
            let nextAnniversary = new Date(startDate);
            nextAnniversary.setFullYear(now.getFullYear());
            
            // å¦‚æœä»Šå¹´çš„çºªå¿µæ—¥å·²ç»è¿‡äº†ï¼Œè®¡ç®—æ˜å¹´çš„
            if (nextAnniversary < now) {
                nextAnniversary.setFullYear(now.getFullYear() + 1);
            }
            
            // è®¡ç®—å‰©ä½™å¤©æ•°
            const diffTime = nextAnniversary - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // æ›´æ–°æ˜¾ç¤º
            const anniversaryText = `è·ç¦»æˆ‘ä»¬${nextAnniversary.getFullYear() - 2025 + 1}å‘¨å¹´çºªå¿µæ—¥è¿˜æœ‰ ${diffDays} å¤©`;
            document.getElementById('next-anniversary').textContent = anniversaryText;
        }
        
        // åˆ›å»ºæ¼‚æµ®çˆ±å¿ƒè£…é¥° - iOSæ€§èƒ½ä¼˜åŒ–
        function createFloatingHearts() {
            const container = document.getElementById('floating-hearts');
            const colors = ['#FF9EBB', '#7CB9E8', '#2E86AB'];
            
            // iOSè®¾å¤‡å‡å°‘çˆ±å¿ƒæ•°é‡ï¼Œæå‡æ€§èƒ½
            const heartCount = isIOS ? 10 : 30;
            
            for (let i = 0; i < heartCount; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.innerHTML = '<i class="fa fa-heart"></i>';
                    heart.className = 'absolute opacity-60 pointer-events-none';
                    heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                    heart.style.left = `${Math.random() * 100}vw`;
                    heart.style.top = '-20px';
                    heart.style.fontSize = `${8 + Math.random() * 16}px`;
                    
                    heart.style.animation = `
                        floatHeart ${5 + Math.random() * 10}s linear forwards,
                        sway ${2 + Math.random() * 4}s ease-in-out infinite alternate
                    `;
                    
                    container.appendChild(heart);
                    
                    // ç§»é™¤è¿‡æœŸçš„çˆ±å¿ƒ
                    setTimeout(() => {
                        heart.remove();
                    }, 15000);
                }, i * 1000);
            }
            
            // å¾ªç¯åˆ›å»ºçˆ±å¿ƒ
            setInterval(() => {
                const heart = document.createElement('div');
                heart.innerHTML = '<i class="fa fa-heart"></i>';
                heart.className = 'absolute opacity-60 pointer-events-none';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.left = `${Math.random() * 100}vw`;
                heart.style.top = '-20px';
                heart.style.fontSize = `${8 + Math.random() * 16}px`;
                
                heart.style.animation = `
                    floatHeart ${5 + Math.random() * 10}s linear forwards,
                    sway ${2 + Math.random() * 4}s ease-in-out infinite alternate
                `;
                
                container.appendChild(heart);
                
                // ç§»é™¤è¿‡æœŸçš„çˆ±å¿ƒ
                setTimeout(() => {
                    heart.remove();
                }, 15000);
            }, 3000);
        }
        
        // åˆ›å»ºæ˜Ÿå…‰è£…é¥°
        function createStars() {
            const container = document.getElementById('stars');
            // iOSè®¾å¤‡å‡å°‘æ˜Ÿæ˜Ÿæ•°é‡
            const starCount = isIOS ? 50 : 100;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'absolute rounded-full bg-white twinkle';
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                star.style.opacity = Math.random() * 0.5 + 0.2;
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                container.appendChild(star);
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬ - ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ
        function initEventListeners() {
            // å¯†ç ç›¸å…³
            document.getElementById('toggle-password').addEventListener('click', () => {
                const passwordInput = document.getElementById('password');
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // åˆ‡æ¢å›¾æ ‡
                document.getElementById('toggle-password').innerHTML = type === 'password' ? 
                    '<i class="fa fa-eye-slash text-lg"></i>' : 
                    '<i class="fa fa-eye text-lg"></i>';
            });
            
            // å¯†ç æäº¤ï¼ˆç¤ºä¾‹å¯†ç ï¼š20250214ï¼‰
            document.getElementById('submit-password').addEventListener('click', () => {
                const password = document.getElementById('password').value;
                if (password === '20250214') {
                    // å¯†ç æ­£ç¡®ï¼Œåˆ‡æ¢åˆ°å€’è®¡æ—¶é¡µé¢
                    showSection('countdown-section', 'password-section', () => {
                        startCountdown();
                        calculateNextAnniversary();
                    });
                    
                    // æ·»åŠ åº†ç¥æ•ˆæœ
                    createCelebration();
                } else {
                    // å¯†ç é”™è¯¯ï¼ŒæŠ–åŠ¨æ•ˆæœ
                    const input = document.getElementById('password');
                    input.classList.add('border-love');
                    input.classList.add('animate-shake');
                    setTimeout(() => {
                        input.classList.remove('animate-shake');
                    }, 500);
                }
            });
            
            // å¯†ç æç¤º
            document.getElementById('hint-btn').addEventListener('click', () => {
                document.getElementById('hint-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('modal-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('modal-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            });
            
            document.getElementById('close-hint').addEventListener('click', () => {
                document.getElementById('modal-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('modal-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('hint-modal').classList.add('hidden');
                }, 300);
            });
            
            // é¡µé¢åˆ‡æ¢
            document.getElementById('to-photo-wall').addEventListener('click', () => {
                showSection('photo-wall-section', 'countdown-section', () => {
                    // åˆå§‹åŒ–3Dç…§ç‰‡å¢™
                    initPhotoSphere();
                });
            });
            
            document.getElementById('to-interaction').addEventListener('click', () => {
                showSection('interaction-section', 'photo-wall-section');
            });
            
            document.getElementById('to-video').addEventListener('click', () => {
                showSection('video-section', 'interaction-section');
            });
            
            document.getElementById('to-final').addEventListener('click', () => {
                showSection('final-section', 'video-section');
            });
            
            document.getElementById('restart-all').addEventListener('click', () => {
                // é‡ç½®æ‰€æœ‰çŠ¶æ€å¹¶è¿”å›å¯†ç é¡µ
                document.getElementById('final-section').classList.add('hidden');
                document.getElementById('password-section').classList.remove('hidden');
                document.getElementById('password-section').classList.remove('opacity-0', 'translate-y-10');
                document.getElementById('password').value = '';
            });
            
            // 3Dç…§ç‰‡å¢™æ§åˆ¶
            document.getElementById('reset-sphere').addEventListener('click', () => {
                // é‡ç½®è§†è§’
                camera.position.set(0, 0, 10);
                controls.reset();
            });
            
            document.getElementById('restart-animation').addEventListener('click', restartGatherAnimation);
            
            document.getElementById('toggle-rotation').addEventListener('click', () => {
                isRotating = !isRotating;
                document.getElementById('toggle-rotation').innerHTML = isRotating ? 
                    '<i class="fa fa-pause mr-1"></i> æš‚åœæ—‹è½¬' : 
                    '<i class="fa fa-play mr-1"></i> å¼€å§‹æ—‹è½¬';
            });
            
            // å…³é—­ç…§ç‰‡æŸ¥çœ‹å¼¹çª—
            document.getElementById('close-photo-modal').addEventListener('click', () => {
                document.getElementById('photo-view-modal').classList.remove('active');
            });
            
            // ç…§ç‰‡ä¸Šä¼ 
            document.getElementById('photo-upload').addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    // è¿™é‡Œå¯ä»¥å¤„ç†ä¸Šä¼ çš„ç…§ç‰‡
                    alert(`å·²é€‰æ‹© ${files.length} å¼ ç…§ç‰‡ï¼Œå°†æ·»åŠ åˆ°ç…§ç‰‡å¢™`);
                }
            });
            
            // è§†é¢‘æ’­æ”¾ - iOSæ”¯æŒå†…è”æ’­æ”¾
            document.getElementById('video-placeholder').addEventListener('click', () => {
                document.getElementById('video-placeholder').style.display = 'none';
                document.getElementById('special-video').play();
            });
            
            // å¼¹å¹•åŠŸèƒ½
            document.getElementById('send-danmaku').addEventListener('click', sendDanmaku);
            document.getElementById('danmaku-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendDanmaku();
                }
            });
            
            // ç•™è¨€æ¿åŠŸèƒ½
            document.getElementById('send-message').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // è¡¨æƒ…æŒ‰é’®
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('message-input').value += btn.dataset.emoji;
                    document.getElementById('message-input').focus();
                });
            });
            
            // é—®ç­”åŠŸèƒ½
            document.getElementById('submit-answer').addEventListener('click', checkAnswer);
            document.getElementById('answer-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
            
            document.getElementById('hint-question').addEventListener('click', () => {
                document.getElementById('question-hint-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('question-hint-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('question-hint-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            });
            
            document.getElementById('close-question-hint').addEventListener('click', () => {
                document.getElementById('question-hint-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('question-hint-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('question-hint-modal').classList.add('hidden');
                }, 300);
            });
            
            document.getElementById('close-fail').addEventListener('click', () => {
                document.getElementById('fail-content').classList.remove('scale-100', 'opacity-100');
                document.getElementById('fail-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    document.getElementById('fail-modal').classList.add('hidden');
                    // è§£é”è§†é¢‘æŒ‰é’®
                    document.getElementById('to-video').disabled = false;
                }, 300);
            });
            
            // å¤´åƒä¸Šä¼ 
            document.getElementById('avatar1-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.querySelector('#countdown-section .rounded-full img').src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('avatar2-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.querySelectorAll('#countdown-section .rounded-full img')[1].src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // å‘é€å¼¹å¹•
        function sendDanmaku() {
            const text = document.getElementById('danmaku-input').value.trim();
            if (text) {
                const danmaku = document.createElement('div');
                danmaku.className = 'absolute whitespace-nowrap text-shadow-soft';
                danmaku.textContent = text;
                
                // éšæœºæ ·å¼
                const fontSize = 14 + Math.random() * 6;
                const top = Math.random() * (document.getElementById('video-danmaku').clientHeight - fontSize - 20);
                const color = `hsl(${Math.random() * 360}, 70%, 50%)`;
                
                danmaku.style.fontSize = `${fontSize}px`;
                danmaku.style.top = `${top}px`;
                danmaku.style.right = `-${danmaku.offsetWidth}px`;
                danmaku.style.color = color;
                danmaku.style.opacity = '0.8';
                
                document.getElementById('video-danmaku').appendChild(danmaku);
                
                // åŠ¨ç”»æ•ˆæœ
                const duration = 8 + Math.random() * 7;
                danmaku.style.transition = `transform ${duration}s linear`;
                setTimeout(() => {
                    danmaku.style.transform = `translateX(-${document.getElementById('video-danmaku').clientWidth + danmaku.offsetWidth}px)`;
                }, 10);
                
                // ç§»é™¤å¼¹å¹•
                setTimeout(() => {
                    danmaku.remove();
                }, duration * 1000);
                
                document.getElementById('danmaku-input').value = '';
            }
        }
        
        // å‘é€ç•™è¨€
        function sendMessage() {
            const message = document.getElementById('message-input').value.trim();
            if (message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'bg-light p-4 rounded-xl text-gray-700 opacity-0';
                
                // æ ¼å¼åŒ–å½“å‰æ—¶é—´
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                messageElement.innerHTML = `
                    <p>${message}</p>
                    <div class="text-right text-xs text-gray-500/70 mt-1">${timeString}</div>
                `;
                
                document.getElementById('messages-container').prepend(messageElement);
                document.getElementById('message-input').value = '';
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                document.getElementById('messages-container').scrollTop = 0;
                
                // æ·»åŠ æ·¡å…¥åŠ¨ç”»
                setTimeout(() => {
                    messageElement.style.transition = 'all 0.5s ease-out';
                    messageElement.style.opacity = '1';
                }, 10);
            }
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = document.getElementById('answer-input').value.trim().toLowerCase();
            const correctAnswers = ['ç«ç‘°', 'ç«ç‘°èŠ±', 'rose'];
            
            if (correctAnswers.some(ans => userAnswer.includes(ans))) {
                // ç­”æ¡ˆæ­£ç¡®
                document.getElementById('answer-feedback').textContent = "å¤ªæ£’äº†ï¼Œç­”å¯¹äº†ï¼";
                document.getElementById('answer-feedback').className = "p-3 rounded-lg mb-4 bg-green-100 text-green-700";
                document.getElementById('answer-feedback').style.display = 'block';
                
                // è§£é”è§†é¢‘æŒ‰é’®
                document.getElementById('to-video').disabled = false;
                
                // æ·»åŠ åº†ç¥æ•ˆæœ
                createCelebration();
            } else {
                // ç­”æ¡ˆé”™è¯¯
                document.getElementById('fail-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('fail-content').classList.remove('scale-95', 'opacity-0');
                    document.getElementById('fail-content').classList.add('scale-100', 'opacity-100');
                }, 50);
            }
        }
        
        // åˆ›å»ºåº†ç¥æ•ˆæœ
        function createCelebration() {
            const container = document.createElement('div');
            container.className = 'fixed inset-0 pointer-events-none z-50';
            document.body.appendChild(container);
            
            const colors = ['#FF9EBB', '#7CB9E8', '#2E86AB', '#F0F8FF'];
            const count = isIOS ? 20 : 50;
            
            for (let i = 0; i < count; i++) {
                const heart = document.createElement('div');
                heart.innerHTML = '<i class="fa fa-heart"></i>';
                heart.className = 'absolute';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.left = `${50 + (Math.random() - 0.5) * 40}vw`;
                heart.style.top = `${50 + (Math.random() - 0.5) * 40}vh`;
                heart.style.fontSize = `${12 + Math.random() * 16}px`;
                heart.style.opacity = '0';
                
                container.appendChild(heart);
                
                // åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    heart.style.transition = 'all 1s ease-out';
                    heart.style.opacity = '0.8';
                    heart.style.transform = `translateY(${(Math.random() - 0.5) * 200}px) rotate(${Math.random() * 360}deg)`;
                }, 10);
                
                // æ·¡å‡ºæ•ˆæœ
                setTimeout(() => {
                    heart.style.transition = 'all 0.5s ease-out';
                    heart.style.opacity = '0';
                }, 1000);
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    heart.remove();
                }, 1500);
            }
            
            // ç§»é™¤å®¹å™¨
            setTimeout(() => {
                container.remove();
            }, 2000);
        }
        
        // æ·»åŠ å…¨å±€åŠ¨ç”»æ ·å¼
        function addGlobalStyles() {
            const style = document.createElement('style');
            style.textContent = `
                @keyframes shake {
                    0%, 100% { transform: translateX(0); }
                    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                    20%, 40%, 60%, 80% { transform: translateX(5px); }
                }
                @keyframes floatHeart {
                    to {
                        transform: translateY(120vh) rotate(720deg);
                        opacity: 0;
                    }
                }
                @keyframes sway {
                    from { transform: translateX(-15px); }
                    to { transform: translateX(15px); }
                }
                .animate-shake {
                    animation: shake 0.5s ease-in-out;
                }
                .trans-1 { transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
                .trans-2 { transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); }
                .trans-3 { transition: all 0.7s cubic-bezier(0.22, 1, 0.36, 1); }
                .trans-4 { transition: all 0.8s cubic-bezier(0.25, 1, 0.5, 1); }
                .trans-5 { transition: all 0.9s cubic-bezier(0.34, 1.56, 0.64, 1); }
                .scrollbar-thin {
                    scrollbar-width: thin;
                }
                .scrollbar-thumb-secondary\/30::-webkit-scrollbar-thumb {
                    background-color: rgba(124, 185, 232, 0.3);
                    border-radius: 4px;
                }
                .scrollbar-thumb-secondary\/30::-webkit-scrollbar {
                    width: 4px;
                }
                /* iOSæ»šåŠ¨è¡Œä¸ºä¼˜åŒ– */
                ::-webkit-scrollbar {
                    width: 6px;
                    height: 6px;
                }
                ::-webkit-scrollbar-track {
                    background: transparent;
                }
                ::-webkit-scrollbar-thumb {
                    background-color: rgba(124, 185, 232, 0.3);
                    border-radius: 3px;
                }
            `;
            document.head.appendChild(style);
        }
        
        // åˆå§‹åŒ–
        function init() {
            addGlobalStyles();
            initEventListeners();
            createFloatingHearts();
            createStars();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
